/*
 * JsonTree plugin
 * Version 1.0
 *
 * Author: Erffun Havaasi
 *
 * License under the GPL-3.0
 * Dual licensed under the MIT and GPL licenses:
 * http://www.gnu.org/licenses/gpl.html
 * https://github.com/Erffun/JsonTree
 *
*/
!function(e){e.fn.jsonTree=function(t,a){function l(t,a){if(t)if(e.isArray(t))for(i=0;i<t.length;i++)n(t[i],a);else n(t,a);return a}function n(t,n){var i=e("<li></li>");if(t.Title&&t.ItemId){var s=e("<span></span>").appendTo(i),d=e("<i></i>").appendTo(s);if(s.append(t.Title),i.data("additional",t.AdditionalData),i.attr("value",t.ItemId),t.Items&&t.Items.length||t.HasSubItem){if(a.lazyLoad&&t.HasSubItem){i.addClass("parent_li"),d.addClass("icon-plus-sign");var c={};c[a.lazySendParameterName]=t.ItemId,d.click(function(){e.ajax({type:a.lazyLoadMethod,url:a.lazyRequestUrl,data:c,dataType:"json"}).done(function(t){if(t){var a=e("<ul></ul>");l(t,a),i.append(a),d.unbind("click")}}).fail(function(e){alert(e)})})}if(t.Items&&t.Items.length){var o=e("<ul></ul>");e(t.Items).each(function(){l(this,o)}),i.append(o)}}n.append(i)}}function s(e){e.removeClass("selectedItem")}a=e.extend({showCheckBox:!1,checkBoxText:"Apply Sub Items",checkBoxElementName:"chkApplySub",checkBoxElementId:"chkApplySub",selectedIdElementName:"hdnSelected",selectedItemId:0,selectedItemIsChecked:!1,mandatorySelect:!1,lazyLoad:!1,lazyRequestUrl:"",lazySendParameterName:"id",lazyLoadMethod:"GET",forceCreate:!1,onSelect:function(){}},a);var d=e(this),c=["icon-folder-open","icon-minus-sign"];if(a.forceCreate||!d.data("treeView")){var o=e("<ul></ul>");l(t,o),d.addClass("tree well").html(o),d.append(e("<input type='hidden' />").attr("name",a.selectedIdElementName));var r=e("li:has(ul)",d);r.addClass("parent_li").find(" > span").attr("title","Collapse this branch"),r.find(" > span i").addClass(c[1]),e("ul",d).on("click","li > span",function(t){var l=e(this),n=l.closest("li");if(n.hasClass("parent_li")&&t.target&&"I"==t.target.nodeName){var i=l.parent("li.parent_li").find(" > ul > li");i.is(":visible")?(i.hide("fast"),e(this).attr("title","Expand this branch").find(" > i").addClass("icon-plus-sign").removeClass("icon-minus-sign")):(i.show("fast"),l.attr("title","Collapse this branch").find(" > i").addClass("icon-minus-sign").removeClass("icon-plus-sign"))}else{if(!l.hasClass("selectedItem")&&(s(e("span",d)),e('input:checkbox[id="'+a.checkBoxElementId+'"],label[for="'+a.checkBoxElementId+'"]',d).remove(),l.addClass("selectedItem"),d.data("selectedItem",n.val()),e('input[name="'+a.selectedIdElementName+'"]').val(n.val()),d.val(n.val()),a.showCheckBox)){var c=e("<label for='"+a.checkBoxElementId+"' ><input type='checkbox' value='true' id='"+a.checkBoxElementId+"' name='"+a.checkBoxElementName+"' /><inpute type='hidden' name='"+a.checkBoxElementName+"' value='false'><small>"+a.checkBoxText+"</small></label>");a.selectedItemId>0&&"True"==a.selectedItemIsChecked&&e(c.find("input[type='checkbox']")[0]).attr("checked","true"),c.insertAfter(l)}a.onSelect&&a.onSelect(n.val(),n,l)}t.stopPropagation()});var m;a.selectedItemId>0?m=e("li[value='"+a.selectedItemId+"'] > span",d):a.mandatorySelect&&(m=e("li > span:first",d)),m&&m.trigger("click"),d.data("treeView",d)}}}(jQuery);